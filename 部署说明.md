# 会议纪要应用部署说明

## 修复内容概述

本次更新修复了以下问题：
1. ✅ 录音音量过小 - 已优化音频配置
2. ✅ 缺少网络状态提示 - 已添加可视化网络状态指示器
3. ⚠️ 语音识别不工作 - 已优化错误处理和提示（根本原因是需要访问Google服务）

## 部署步骤

### 1. 构建 Web 应用

```bash
# 安装依赖（如果还没有安装）
npm install

# 构建生产版本
npm run build
```

构建完成后，会在 `dist` 目录生成优化后的文件。

### 2. 同步到 Android 项目

```bash
# 同步 Web 资源到 Android 项目
npm run android:sync
```

这个命令会：
- 将 `dist` 目录的内容复制到 Android 项目的 assets 目录
- 更新 Capacitor 配置
- 同步原生插件

### 3. 构建 Android APK

#### 方法1：使用命令行（推荐）

```bash
# 构建 Release 版本
npm run android:build
```

生成的 APK 文件位置：
```
android/app/build/outputs/apk/release/app-release-unsigned.apk
```

#### 方法2：使用 Android Studio

```bash
# 打开 Android Studio
npm run android:open
```

然后在 Android Studio 中：
1. 等待 Gradle 同步完成
2. 选择 `Build` -> `Build Bundle(s) / APK(s)` -> `Build APK(s)`
3. 等待构建完成
4. 点击通知中的 `locate` 查看生成的 APK

### 4. 签名 APK（可选，用于发布）

如果需要发布到应用商店或正式分发，需要对 APK 进行签名。

#### 生成签名密钥（首次）

```bash
cd android
keytool -genkey -v -keystore my-release-key.keystore -alias my-key-alias -keyalg RSA -keysize 2048 -validity 10000
```

按提示输入密钥信息。

#### 配置签名

编辑 `android/app/build.gradle`，添加签名配置：

```gradle
android {
    ...
    signingConfigs {
        release {
            storeFile file("my-release-key.keystore")
            storePassword "your-keystore-password"
            keyAlias "my-key-alias"
            keyPassword "your-key-password"
        }
    }
    buildTypes {
        release {
            signingConfig signingConfigs.release
            ...
        }
    }
}
```

然后重新构建：

```bash
npm run android:build
```

### 5. 安装到手机

#### 方法1：通过 USB 连接

```bash
# 确保手机已开启 USB 调试
# 连接手机到电脑

# 安装 APK
adb install android/app/build/outputs/apk/release/app-release.apk

# 如果已安装旧版本，使用 -r 参数覆盖安装
adb install -r android/app/build/outputs/apk/release/app-release.apk
```

#### 方法2：直接传输 APK

1. 将 APK 文件传输到手机（通过 USB、蓝牙、网络等）
2. 在手机上找到 APK 文件
3. 点击安装（可能需要允许"未知来源"的应用安装）

## 验证部署

安装完成后，请按照 `测试说明.md` 中的步骤进行测试，确保所有功能正常工作。

### 关键验证点

1. **录音音量**
   - 录制一段测试音频
   - 播放检查音量是否清晰

2. **网络状态提示**
   - 打开应用，查看是否显示网络状态指示器
   - 切换网络状态（WiFi/移动数据/离线），观察提示是否更新

3. **语音识别**
   - 在有 VPN 的环境下测试实时转写
   - 在无 VPN 的环境下确认提示正确显示
   - 确认纯录音模式可以正常工作

## 常见问题

### Q1: 构建失败，提示 Gradle 错误

**解决方法**：
```bash
# 清理 Gradle 缓存
cd android
./gradlew clean

# 重新构建
./gradlew assembleRelease
```

### Q2: 安装时提示"解析包时出现问题"

**可能原因**：
- APK 文件损坏
- 签名不匹配（如果覆盖安装）
- Android 版本不兼容

**解决方法**：
1. 重新下载或传输 APK
2. 卸载旧版本后重新安装
3. 检查手机 Android 版本是否满足要求（建议 Android 7.0+）

### Q3: 安装后无法打开，闪退

**解决方法**：
1. 检查手机是否授予了必要的权限（麦克风、存储）
2. 查看 logcat 日志：
   ```bash
   adb logcat | grep -i "meetingminutes"
   ```
3. 尝试清除应用数据后重新打开

### Q4: 语音识别仍然不工作

**这是预期行为**，因为：
- Web Speech API 需要访问 Google 服务
- 即使开启 VPN，Android WebView 可能不会使用系统 VPN
- 应用会显示明确的提示信息

**解决方案**：
1. 使用纯录音模式，稍后手动添加文字
2. 考虑集成国内语音识别服务（需要额外开发）

## 文件清单

本次修改的文件：

### 核心功能文件
- `src/services/audioRecorder.ts` - 音频录制服务（优化音量）
- `src/services/speechRecognition.ts` - 语音识别服务（优化错误处理）
- `src/views/RecordView.vue` - 录音页面（添加网络状态提示）

### Android 配置文件
- `android/app/src/main/java/com/meetingminutes/app/MainActivity.java` - WebView 配置

### 文档文件
- `测试说明.md` - 详细的测试步骤和验证点
- `部署说明.md` - 本文件
- `语音识别网络问题说明.md` - 网络问题的技术说明（已存在）

## 版本信息

- **版本号**: 1.0.1（建议更新 package.json 中的版本号）
- **构建日期**: 2025-11-08
- **主要改进**:
  - 优化录音音量
  - 添加网络状态检测和提示
  - 改进错误处理和用户体验
  - 支持纯录音模式

## 后续建议

### 短期改进
1. 添加音频播放音量控制
2. 优化网络检测的性能
3. 添加更多语言支持

### 长期改进
1. **集成国内语音识别服务**（推荐）
   - 阿里云语音识别
   - 腾讯云语音识别
   - 讯飞语音识别
   
2. **使用 Android 原生语音识别**
   - 创建 Capacitor 插件
   - 使用 Android SpeechRecognizer API
   - 支持离线识别

3. **添加离线语音识别**
   - 集成离线语音识别模型
   - 减少对网络的依赖

## 技术支持

如有问题，请查看：
1. `测试说明.md` - 详细的测试和故障排查指南
2. `语音识别网络问题说明.md` - 网络问题的技术说明
3. 浏览器控制台日志 - 查看详细的错误信息

## 更新日志

### v1.0.1 (2025-11-08)
- ✅ 修复录音音量过小的问题
- ✅ 添加网络状态检测和可视化提示
- ✅ 优化语音识别错误处理
- ✅ 配置 Android WebView 音频权限
- ✅ 支持纯录音模式（无网络环境）
- ✅ 改进用户体验和错误提示

### v1.0.0 (初始版本)
- 基础录音功能
- 语音识别功能
- 会议记录管理

