# 会议纪要应用修复测试说明

## 修复内容总结

本次修复解决了以下三个问题：

### 1. ✅ 录音音量过小
**问题描述**：录音声音很小，难以听清
**修复方案**：
- 提高音频采样率到 48000 Hz
- 启用音频增益控制 (autoGainControl)
- 动态检测并应用设备支持的最大音量设置
- 优化音频轨道约束配置

**修改文件**：`src/services/audioRecorder.ts`

### 2. ✅ 缺少网络状态提示
**问题描述**：没有网络状态提示，用户不知道为什么语音识别不工作
**修复方案**：
- 添加可视化网络状态指示器，显示四种状态：
  - 🔄 检测中
  - ✅ 网络正常，支持实时转写
  - ⚠️ 网络离线，仅支持录音
  - ℹ️ 语音识别服务不可用
- 实时监测网络连接状态
- 主动测试语音识别服务连接
- 在录音开始前给出明确提示

**修改文件**：`src/views/RecordView.vue`

### 3. ✅ 语音识别不工作（部分解决）
**问题描述**：即使开启VPN，实时转写功能仍然不工作
**根本原因**：Web Speech API 需要连接到 Google 服务器，Android WebView 可能不会正确使用系统 VPN
**修复方案**：
- 优化网络错误检测和提示
- 添加网络错误重试机制（最多3次）
- 配置 Android WebView 以支持音频录制权限
- 在网络不可用时允许纯录音模式
- 提供详细的错误信息和解决建议

**修改文件**：
- `src/services/speechRecognition.ts`
- `src/views/RecordView.vue`
- `android/app/src/main/java/com/meetingminutes/app/MainActivity.java`

## 测试步骤

### 准备工作
1. 确保手机已安装最新版本的应用
2. 准备测试环境：
   - 有 VPN 的网络环境
   - 无 VPN 的网络环境
   - 离线环境

### 测试1：录音音量测试
**目标**：验证录音音量是否提高

1. 打开应用，进入录音页面
2. 点击"开始录音"按钮
3. 以正常音量说话（距离手机约30cm）
4. 说一段测试内容（约30秒）
5. 停止录音
6. 进入会议列表，播放刚才的录音
7. **验证点**：
   - ✅ 录音音量清晰，可以正常听清内容
   - ✅ 音量比之前版本明显提高
   - ✅ 没有明显的噪音或失真

### 测试2：网络状态提示测试
**目标**：验证网络状态提示是否正常显示

#### 测试2.1：正常网络（有VPN）
1. 确保手机连接到网络并开启 VPN
2. 打开应用，进入录音页面
3. **验证点**：
   - ✅ 页面顶部显示网络状态指示器
   - ✅ 状态显示为"网络正常，支持实时转写"（绿色）
   - ✅ 图标为成功图标（✓）

#### 测试2.2：网络离线
1. 关闭手机的 WiFi 和移动数据
2. 打开应用，进入录音页面
3. **验证点**：
   - ✅ 状态显示为"网络离线，仅支持录音"（橙色）
   - ✅ 图标为警告图标（⚠）

#### 测试2.3：无法访问Google服务（无VPN）
1. 确保手机连接到网络但关闭 VPN
2. 打开应用，进入录音页面
3. **验证点**：
   - ✅ 状态显示为"语音识别服务不可用"（蓝色）
   - ✅ 图标为信息图标（ℹ）

### 测试3：语音识别功能测试

#### 测试3.1：正常网络环境（有VPN）
1. 确保手机连接到网络并开启 VPN
2. 打开应用，进入录音页面
3. 确认网络状态显示为"网络正常"
4. 点击"开始录音"
5. 清晰地说一段话（例如："今天我们讨论了项目进度和下一步计划"）
6. **验证点**：
   - ✅ 录音正常开始
   - ✅ 说话时能看到实时转写的文字（可能有临时文字）
   - ✅ 停顿后文字变为最终结果
   - ✅ 转写内容基本准确

#### 测试3.2：网络离线环境
1. 关闭手机的 WiFi 和移动数据
2. 打开应用，进入录音页面
3. 点击"开始录音"
4. **验证点**：
   - ✅ 弹出确认对话框，提示"网络离线，无法使用实时转写功能"
   - ✅ 对话框说明录音功能正常，可以稍后手动输入文字
   - ✅ 点击"确定"后可以继续录音
   - ✅ 录音过程中没有实时转写文字
   - ✅ 录音功能正常工作

#### 测试3.3：无法访问Google服务（无VPN）
1. 确保手机连接到网络但关闭 VPN
2. 打开应用，进入录音页面
3. 点击"开始录音"
4. **验证点**：
   - ✅ 弹出确认对话框，提示"语音识别服务不可用"
   - ✅ 对话框说明可能需要特殊网络环境
   - ✅ 点击"确定"后可以继续录音
   - ✅ 录音过程中没有实时转写文字
   - ✅ 录音功能正常工作

#### 测试3.4：网络错误重试机制
1. 开启 VPN 并开始录音
2. 在录音过程中关闭 VPN
3. **验证点**：
   - ✅ 出现网络错误提示
   - ✅ 系统自动重试（最多3次）
   - ✅ 3次失败后显示详细错误信息
   - ✅ 录音功能继续正常工作

### 测试4：综合功能测试

#### 测试4.1：完整录音流程（有VPN）
1. 开启 VPN，打开应用
2. 进入录音页面，确认网络状态正常
3. 选择识别语言（如"普通话"）
4. 点击"开始录音"
5. 说一段完整的会议内容（2-3分钟）
6. 点击"停止录音"
7. 查看转写结果
8. 保存会议记录
9. **验证点**：
   - ✅ 整个流程顺畅无卡顿
   - ✅ 实时转写基本准确
   - ✅ 录音音量清晰
   - ✅ 会议记录成功保存

#### 测试4.2：完整录音流程（无VPN）
1. 关闭 VPN，打开应用
2. 进入录音页面，确认网络状态提示
3. 点击"开始录音"，确认继续
4. 录制一段内容（1-2分钟）
5. 点击"停止录音"
6. **验证点**：
   - ✅ 录音功能正常
   - ✅ 录音音量清晰
   - ✅ 没有实时转写（符合预期）
   - ✅ 可以手动编辑文字内容

## 已知限制

### 语音识别服务限制
- **Web Speech API 依赖 Google 服务**：应用使用的是浏览器内置的 Web Speech API，该 API 需要连接到 Google 的语音识别服务器
- **VPN 可能不完全有效**：即使手机开启了 VPN，Android WebView 组件可能不会完全使用系统的 VPN 设置
- **建议的解决方案**：
  1. 使用国内语音识别服务（如阿里云、腾讯云、讯飞等）
  2. 使用 Android 原生语音识别 API
  3. 使用离线语音识别模型

### 录音功能
- ✅ 录音功能不依赖网络，在任何情况下都能正常工作
- ✅ 录音音量已优化，应该能满足正常使用需求
- ✅ 支持纯录音模式，可以稍后手动添加文字

## 故障排查

### 问题1：网络状态一直显示"检测中"
**可能原因**：网络检测超时
**解决方法**：
1. 检查网络连接
2. 刷新页面重新检测
3. 查看浏览器控制台是否有错误信息

### 问题2：有VPN但仍提示"服务不可用"
**可能原因**：
1. VPN 未正确配置
2. WebView 未使用系统 VPN
3. Google 服务被防火墙阻止

**解决方法**：
1. 确认 VPN 在浏览器中可以访问 Google
2. 尝试重启应用
3. 使用纯录音模式，稍后手动添加文字

### 问题3：录音音量仍然很小
**可能原因**：
1. 设备麦克风硬件问题
2. 麦克风权限未正确授予
3. 设备不支持高采样率

**解决方法**：
1. 检查麦克风权限设置
2. 在设备设置中测试麦克风
3. 尝试在其他应用中录音对比
4. 查看浏览器控制台的音频配置日志

## 技术细节

### 音频配置
```typescript
{
  echoCancellation: true,      // 回声消除
  noiseSuppression: true,      // 噪音抑制
  autoGainControl: true,       // 自动增益控制
  sampleRate: 48000,           // 采样率 48kHz
  channelCount: 1,             // 单声道
  volume: 1.0,                 // 最大音量
  latency: 0                   // 最小延迟
}
```

### 网络检测逻辑
1. 检查基本网络连接（navigator.onLine）
2. 检查 Speech Recognition API 支持
3. 尝试启动语音识别服务（3秒超时）
4. 根据结果更新网络状态

### 错误重试机制
- 网络错误自动重试最多3次
- 30秒内的错误累计计数
- 超过30秒自动重置计数器
- 3次失败后停止识别，但录音继续

## 反馈

如果在测试过程中发现任何问题，请记录：
1. 问题描述
2. 复现步骤
3. 网络环境（有/无VPN，WiFi/移动数据）
4. 设备型号和 Android 版本
5. 浏览器控制台的错误信息（如果有）

