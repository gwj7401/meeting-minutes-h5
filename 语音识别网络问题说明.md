# 🌐 语音识别网络问题说明

## 问题现象

在使用录音功能时，控制台显示：
```
语音识别错误: network
网络错误，请检查网络连接
```

录音功能正常，但**没有实时文字转换**。

---

## 问题原因

Web Speech API 使用 **Google 的在线语音识别服务**，需要：

1. ✅ 网络连接正常
2. ✅ 能够访问 Google 服务器
3. ✅ 浏览器支持（Chrome/Edge）

**在中国大陆**，由于网络限制，可能无法访问 Google 的语音识别服务，导致网络错误。

---

## 解决方案

### 方案 1：使用特殊网络环境 🌍

如果你有访问 Google 服务的网络环境：

1. 连接到可以访问 Google 的网络
2. 刷新页面
3. 重新开始录音

**测试是否可以访问 Google：**
- 访问 https://www.google.com
- 如果能打开，说明网络环境正常

---

### 方案 2：使用 Android APK（推荐）📱

直接构建 Android APK，在手机上使用：

```bash
# 初始化 Android 项目
npm run android:init

# 同步代码
npm run android:sync

# 构建 APK
npm run android:build
```

APK 位置: `android/app/build/outputs/apk/debug/app-debug.apk`

**优势：**
- ✅ 原生应用体验
- ✅ 可以配置使用国内语音识别服务
- ✅ 性能更好

---

### 方案 3：集成国内语音识别服务 🇨🇳

可以替换为国内的语音识别服务：

#### 选项 A：阿里云语音识别

- 官网：https://www.aliyun.com/product/nls
- 免费额度：每月 2 小时
- 支持实时语音识别

#### 选项 B：腾讯云语音识别

- 官网：https://cloud.tencent.com/product/asr
- 免费额度：每月 10 小时
- 支持实时语音识别

#### 选项 C：讯飞语音识别

- 官网：https://www.xfyun.cn/services/voicedictation
- 免费额度：每日 500 次
- 支持实时语音识别

**注意：** 这些服务需要：
1. 注册账号
2. 申请 API Key
3. 修改代码集成 SDK

---

### 方案 4：仅使用录音功能 🎤

即使语音识别不可用，录音功能仍然正常：

1. ✅ 可以正常录音
2. ✅ 可以保存音频文件
3. ✅ 可以播放录音
4. ❌ 无法实时转文字

**使用流程：**
1. 点击"开始录音"
2. 说话（会正常录音）
3. 点击"停止录音"
4. 在会议详情页手动输入文字内容
5. 可以播放录音回听

---

## 当前应用的处理方式

应用已经做了优化处理：

### 1. 友好的错误提示

当语音识别网络错误时，会显示：
```
语音识别服务连接失败
录音功能正常，但无法实时转文字
您可以继续录音，稍后手动输入文字
```

### 2. 录音功能不受影响

- ✅ 录音正常工作
- ✅ 音频正常保存
- ✅ 可以播放回听

### 3. 可以手动编辑文字

在会议详情页面：
1. 播放录音
2. 手动输入/编辑文字内容
3. 保存

---

## 测试语音识别是否可用

在浏览器控制台运行以下代码：

```javascript
// 测试 Web Speech API 网络连接
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition

if (SpeechRecognition) {
  const recognition = new SpeechRecognition()
  recognition.lang = 'zh-CN'
  
  recognition.onstart = () => {
    console.log('✅ 语音识别已启动，请说话...')
  }
  
  recognition.onresult = (e) => {
    console.log('✅ 识别成功:', e.results[0][0].transcript)
  }
  
  recognition.onerror = (e) => {
    if (e.error === 'network') {
      console.error('❌ 网络错误：无法连接到 Google 语音识别服务')
      console.log('💡 可能原因：')
      console.log('   1. 网络连接问题')
      console.log('   2. 无法访问 Google 服务（中国大陆）')
      console.log('   3. 防火墙/代理设置')
    } else {
      console.error('❌ 错误:', e.error)
    }
  }
  
  recognition.start()
} else {
  console.error('❌ 浏览器不支持 Web Speech API')
}
```

---

## 推荐方案对比

| 方案 | 难度 | 成本 | 实时转文字 | 适用场景 |
|------|------|------|-----------|----------|
| 特殊网络环境 | ⭐ | 免费 | ✅ | 有条件访问 Google |
| Android APK | ⭐⭐ | 免费 | ❌ (需集成) | 手机使用 |
| 国内语音服务 | ⭐⭐⭐ | 有免费额度 | ✅ | 中国大陆用户 |
| 仅录音功能 | ⭐ | 免费 | ❌ | 简单录音需求 |

---

## 最佳实践建议

### 个人使用

**推荐：** 使用 Android APK + 仅录音功能
- 构建 APK 安装到手机
- 录音后手动输入文字
- 简单实用

### 团队/商业使用

**推荐：** 集成国内语音识别服务
- 选择阿里云/腾讯云/讯飞
- 申请 API Key
- 修改代码集成
- 稳定可靠

### 临时测试

**推荐：** 仅使用录音功能
- 不需要配置
- 立即可用
- 手动输入文字

---

## 如何集成国内语音识别服务

### 示例：集成阿里云实时语音识别

1. **注册阿里云账号并开通服务**
   - 访问 https://www.aliyun.com/product/nls
   - 开通实时语音识别服务
   - 获取 AccessKey ID 和 AccessKey Secret

2. **安装 SDK**
   ```bash
   npm install alibabacloud-nls-realtime-asr-sdk
   ```

3. **修改 `src/services/speechRecognition.ts`**
   ```typescript
   // 替换为阿里云 SDK
   import NlsClient from 'alibabacloud-nls-realtime-asr-sdk'
   
   // 实现类似的接口
   // ...
   ```

4. **配置 API Key**
   ```typescript
   const client = new NlsClient({
     accessKeyId: 'YOUR_ACCESS_KEY_ID',
     accessKeySecret: 'YOUR_ACCESS_KEY_SECRET',
     appKey: 'YOUR_APP_KEY'
   })
   ```

**注意：** 具体实现需要参考各服务商的 SDK 文档。

---

## 常见问题

### Q1: 为什么录音正常但没有文字？

**A:** Web Speech API 需要访问 Google 服务。如果网络无法访问 Google，语音识别会失败，但录音功能不受影响。

### Q2: 可以离线使用语音识别吗？

**A:** Web Speech API 不支持离线。如果需要离线识别，需要：
- 使用 Android 原生语音识别 API
- 或集成支持离线的第三方 SDK

### Q3: 使用国内语音服务需要付费吗？

**A:** 大部分服务都有免费额度：
- 阿里云：每月 2 小时免费
- 腾讯云：每月 10 小时免费
- 讯飞：每日 500 次免费

超出免费额度后需要付费。

### Q4: 录音文件保存在哪里？

**A:** 保存在浏览器的 IndexedDB 中，数据存储在本地，不会上传到服务器。

---

## 总结

✅ **当前状态：**
- 录音功能正常
- 音频保存正常
- 语音识别因网络问题不可用

✅ **推荐方案：**
1. 短期：使用录音功能 + 手动输入文字
2. 长期：构建 Android APK 或集成国内语音服务

✅ **应用已优化：**
- 友好的错误提示
- 录音功能不受影响
- 可以手动编辑文字

---

**如有其他问题，请参考相关文档或提出反馈。** 📝

