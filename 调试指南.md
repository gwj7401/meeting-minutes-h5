# 🔍 调试指南

## 问题：停止录音按钮不起作用，文字没有转换

### 调试步骤

#### 1. 打开浏览器开发者工具

按 `F12` 或右键点击页面 → "检查"

#### 2. 查看控制台 (Console)

在控制台中应该能看到以下日志：

**正常情况下的日志顺序：**

```
设置语音识别回调
开始录音...
会议记录已创建
请求麦克风权限...
麦克风权限已获取
MediaRecorder 已创建
MediaRecorder start() 调用成功
录音已启动
启动语音识别，语言: zh-CN
语音识别 start() 调用成功
MediaRecorder 已启动
语音识别已启动
收到音频数据块，大小: XXXX
收到语音识别结果事件
识别文本: XXX 是否最终: false
收到识别结果: {text: "XXX", isFinal: false, timestamp: XXXX}
```

#### 3. 检查可能的错误

##### 错误 1: 麦克风权限被拒绝

**错误信息：**
```
启动录音失败: NotAllowedError
```

**解决方案：**
1. 点击地址栏左侧的锁图标或信息图标
2. 找到"麦克风"权限
3. 选择"允许"
4. 刷新页面重试

##### 错误 2: 浏览器不支持 Web Speech API

**错误信息：**
```
浏览器不支持语音识别
```

**解决方案：**
- 使用 Chrome 或 Edge 浏览器
- 确保浏览器版本是最新的

##### 错误 3: 网络错误

**错误信息：**
```
语音识别错误: network
```

**解决方案：**
- 检查网络连接
- Web Speech API 需要联网（使用 Google 的语音识别服务）

##### 错误 4: 没有检测到语音

**错误信息：**
```
语音识别错误: no-speech
```

**解决方案：**
- 确保麦克风正常工作
- 说话声音要足够大
- 检查系统麦克风设置

#### 4. 手动测试 Web Speech API

在浏览器控制台中运行以下代码：

```javascript
// 测试 Web Speech API 是否可用
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition
console.log('Web Speech API 支持:', !!SpeechRecognition)

// 如果支持，测试启动
if (SpeechRecognition) {
  const recognition = new SpeechRecognition()
  recognition.lang = 'zh-CN'
  recognition.continuous = true
  recognition.interimResults = true
  
  recognition.onstart = () => console.log('✅ 语音识别已启动')
  recognition.onresult = (e) => {
    const result = e.results[e.results.length - 1]
    console.log('✅ 识别结果:', result[0].transcript)
  }
  recognition.onerror = (e) => console.error('❌ 错误:', e.error)
  recognition.onend = () => console.log('⚠️ 语音识别结束')
  
  recognition.start()
  console.log('已调用 start()，请说话...')
}
```

#### 5. 测试麦克风

在浏览器控制台中运行：

```javascript
// 测试麦克风访问
navigator.mediaDevices.getUserMedia({ audio: true })
  .then(stream => {
    console.log('✅ 麦克风访问成功')
    console.log('音频轨道:', stream.getAudioTracks())
    stream.getTracks().forEach(track => track.stop())
  })
  .catch(error => {
    console.error('❌ 麦克风访问失败:', error)
  })
```

---

## 常见问题解决

### 问题 1: 点击"开始录音"后没有反应

**可能原因：**
- 麦克风权限被拒绝
- 浏览器不支持

**解决方案：**
1. 检查控制台错误信息
2. 允许麦克风权限
3. 使用 Chrome 或 Edge 浏览器

### 问题 2: 录音开始了，但没有文字显示

**可能原因：**
- 没有说话或声音太小
- 网络问题
- 语音识别服务错误

**解决方案：**
1. 确保说话声音足够大
2. 检查网络连接
3. 查看控制台是否有 "收到语音识别结果事件" 日志
4. 尝试刷新页面重新开始

### 问题 3: 停止录音按钮点击没反应

**可能原因：**
- JavaScript 错误
- 状态管理问题

**解决方案：**
1. 查看控制台是否有错误
2. 刷新页面重试
3. 检查是否有 "停止录音..." 日志

### 问题 4: 文字识别不准确

**可能原因：**
- 环境噪音大
- 发音不清晰
- 语言设置不正确

**解决方案：**
1. 在安静的环境中录音
2. 说话清晰
3. 选择正确的识别语言（普通话/粤语等）

---

## 浏览器兼容性

### ✅ 支持的浏览器

| 浏览器 | 版本 | Web Speech API | MediaRecorder |
|--------|------|----------------|---------------|
| Chrome | 25+ | ✅ | ✅ |
| Edge   | 79+ | ✅ | ✅ |

### ❌ 不支持的浏览器

| 浏览器 | 原因 |
|--------|------|
| Firefox | 不支持 Web Speech API |
| Safari | 不支持 Web Speech API |
| IE | 不支持现代 Web API |

---

## 网络要求

⚠️ **重要**: Web Speech API 使用 Google 的在线语音识别服务，**需要联网**。

- 确保网络连接正常
- 如果在中国大陆，可能需要特殊网络环境访问 Google 服务

---

## 调试技巧

### 1. 启用详细日志

代码中已经添加了详细的 `console.log`，打开控制台即可查看。

### 2. 检查网络请求

1. 打开开发者工具
2. 切换到 "Network" (网络) 标签
3. 开始录音并说话
4. 查看是否有到 Google 服务器的请求

### 3. 检查麦克风状态

在录音时，浏览器标签页应该显示麦克风图标 🎤

### 4. 测试系统麦克风

1. Windows: 设置 → 系统 → 声音 → 输入设备
2. macOS: 系统偏好设置 → 声音 → 输入
3. 说话时应该能看到音量条波动

---

## 如果问题仍然存在

### 方案 1: 使用 Android APK

如果 Web 版本有问题，可以直接构建 Android APK：

```bash
npm run android:init
npm run android:sync
npm run android:build
```

### 方案 2: 使用其他语音识别服务

如果 Web Speech API 不可用，可以考虑：
- 阿里云语音识别
- 腾讯云语音识别
- 讯飞语音识别

（需要修改代码并申请 API Key）

---

## 获取帮助

如果以上方法都无法解决问题，请提供以下信息：

1. **浏览器信息**
   - 浏览器名称和版本
   - 操作系统

2. **控制台日志**
   - 完整的控制台输出
   - 错误信息截图

3. **网络状态**
   - 是否能访问 Google 服务
   - 网络连接是否正常

4. **重现步骤**
   - 详细描述操作步骤
   - 问题出现的时机

---

**祝你调试顺利！** 🔧

